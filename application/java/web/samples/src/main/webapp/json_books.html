<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script type="text/javascript" src="js/json2.js"></script> 
    <script type="text/javascript" src="js/prototype.js"></script>
    <title>JSON Book service</title>
  </head>
  
  <script type="text/javascript">
    <!--
    
    function getBookData() {
      var isdn = $('isdn_value').value.replace(/(^\s*)|(\s*$)/g, "");
      if (isdn == "") {
        alert("Isdn must be specified.");
        return;
      }
      var request = new Ajax.Request(                                                                                                                       
        "rest/samples/json/" + isdn + "/",                                                                                                                                                
        {          
          method: "GET",
          requestHeaders:{ 'Accept':'application/json' },
          onSuccess: updateCart,                                                                                                                            
          onFailure: _error_
        }                                                                                                                                                   
      );                              
    }

    //response - json stream
    function updateCart(req) {
      var jsonBookCart = req.responseText.replace(/(^\s*)|(\s*$)/g, "");
      if (jsonBookCart == "") {
        return;
      }
      var book = eval('(' + jsonBookCart + ')');
      $('isdn_value').value = book.isdn;
      $('title_value').value = book.title;
      $('author_value').value = book.author;
      $('pages_value').value = book.pages;
      $('price_value').value = book.price;
    }

    function sendBookData() {
      if($('isdn_value').value.replace(/(^\s*)|(\s*$)/g, "") == "") {
        alert("Isdn must be specified.");
        return;
      }
      var o = new Book(
        $('isdn_value').value,
        $('title_value').value,
        $('author_value').value,
        parseInt($('pages_value').value),
        parseFloat($('price_value').value)
      );
      var str = JSON.stringify(o);
      var request = new Ajax.Request(                                                                                                                       
        "rest/samples/json/",                                                                                                                                                
        {          
          method: "POST",
          /*requestHeaders:{ 'Content-type':'application/json' },*/
          contentType : 'application/json',
          postBody: str,
          onFailure: _error_
        }                                                                                                                                                   
      );                              
    }

    function Book (isdn, title, author, pages, price) {
      this.title = title || "empty";
      this.author = author || "empty";
      this.pages = pages || 0;
      this.price = price || 0.0;
      this.isdn = isdn;
    }
    
    function _clear_() {
      $('isdn_value').value = "";
      $('title_value').value = "";
      $('author_value').value = "";
      $('pages_value').value = "";
      $('price_value').value = "";
    }
    
    function _error_(req) {
      alert("HTTP error "+req.status+": "+req.statusText);
    }
//-->
  </script>
  
  <style type="text/css">
    div.book{
      width:300px;
      border: 1px solid gray;
      padding:10px;
      margin-left: auto;
      margin-right: auto;
      margin-top: 20px;
      font-size: 12px;
      font-family: Verdana;
    }
    div.book .caption{
      text-align: center;
      font-size: 16px;
      font-family: Arial;
      font-weight: bold;
      border-bottom: 1px solid gray;
    }
    div.book .field{
      margin-top: 5px;
      margin-bottom: 5px;
    }
    div.book .field .key{
      float:left;
      height: 20px;
      width: 100px;
      font-weight: bold;
    }
    div.book .field .value{
      float:none;
      height: 20px;
      border: solid 1px #cccccc;
    }
    div.form{
      width: 100%;
      text-align: center;
      margin-top: 10px;
    }
  </style>
  
  <body>
    <div class = "book">
      <div class="caption">Book</div>
      <div class="field">
        <div class = "key">Isdn : </div>
        <input type="text" class = "value" id = "isdn_value"  value="1234567890" />
      </div>
      <div class="field">
        <div class = "key">Title : </div>
        <input type="text" class = "value" id = "title_value"/>
      </div>
      <div class="field">
        <div class = "key">Author : </div>
        <input type="text" class = "value" id = "author_value"/>
      </div>
      <div class="field">
        <div class = "key">Pages : </div>
        <input type="text" class = "value" id = "pages_value"/>
      </div>
      <div class="field">
        <div class = "key">Price : </div>
        <input type="text" class = "value" id = "price_value"/>
      </div>
    </div>
    <div class="form">
      <input type="button" value="Get" onclick="getBookData();"/>
      <input type="button" value="Post" onclick="sendBookData();"/>
      <input type="button" value="Clear" onclick="_clear_();"/> 
    </div>
  </body>
  
</html>